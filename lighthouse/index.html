<!doctype html>
<head>
<title>The Lighthouse</title>
<script src="p5.js"></script>
<script src="p5.play.js"></script>
<script>
    var clouds1x=0;
    var clouds2x=0;
    var clouds3x=0;
    var clouds4x=0;
    var clouds5x=0;

    var clickedX=0;
    var clickedY=0;
    var speed = 25;
    var interact = 0;

    var lettercheck = 0;
    var todaysletter;
    var letternumber = 0;

    var todaysfood;
    var foodnumber=0;
    var foodcheck=0;

    class Room {
        constructor(x,y){
            this.x = x;
            this.y = y;
        }
    }

    var house = new Room(562,585);
    var stairs = new Room(491,575);
    var upstairs1 = new Room(398,586);
    var upstairs2 = new Room(337,550);
    var upstairs3 = new Room(258,498);
    var upstairs4 = new Room(318,451);
    var upstairs5 = new Room(374,425);
    var upstairs6 = new Room(421,394);
    var upstairs7 = new Room(508,374);
    var lighthouse = new Room(497,372); 

    class Character {
        constructor(x,y,room,state){
            this.x = x;
            this.y = y;
            this.room = room;
            this.animx = 0;
            this.animy = 0;
            this.destinationx = [];
            this.destinationy = [];
            this.distancex = 0;
            this.distancey = 0;

            this.objectstate = "standing";
            this.actionstate = "idle";
        }
    }

    var keeper = new Character(549,580,house,"standing");

    class Interactable {
        constructor(room,name,x,y,width,height,pic){
            this.room = room;
            this.name = name;
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height; 
        }
        setImage(pic){
            this.pic = pic;
        }
        clickcheck(clickedX,clickedY){
            if (
                clickedX >= this.x && 
                clickedX <= this.x + this.width &&
                clickedY >= this.y &&
                clickedY <= this.y + this.height
            ) {
                return true;
            } else {
                return false;
            }
        }
    }

    var bed = new Interactable(house,"bed", 560, 539, 85, 50);
    var icebox = new Interactable(house,"icebox", 681, 589, 28, 47);
    var tube = new Interactable(stairs,"tube",388,558,24,52);
    var balcony1 = new Interactable(lighthouse,"balcony1",244,362,78,67);
    var balcony2 = new Interactable(lighthouse,"balcony2",322,362,78,67);
    var balcony3 = new Interactable(lighthouse,"balcony3",400,362,78,67);
    var balcony4 = new Interactable(lighthouse,"balcony4",478,362,78,67);
    var allobjects = [bed, icebox, tube, balcony1, balcony2, balcony3, balcony4];

    

function preload(){
    // clouds
    clouds1=loadImage('clouds1.png');
    clouds2=loadImage('clouds2.png');
    clouds3=loadImage('clouds3.png');
    clouds4=loadImage('clouds4.png');
    clouds5=loadImage('clouds5.png');

    // lighthouse images
    lighthousebg=loadImage('lighthouse/bg.png');
    light=loadAnimation('lighthouse/light/1.png','lighthouse/light/4.png');
    arch=loadImage('lighthouse-arch.png');

    // interactable objects
    icebox.setImage(loadImage('objects/icebox.png'));
    bed.setImage(loadImage('objects/bed.png'));
    tube.setImage(loadImage('objects/tube.png'));
    balcony1.setImage(loadImage('objects/balcony1.png'));
    balcony3.setImage(loadImage('objects/balcony2.png'));

    // keeper images and animations
    keeperstanding=loadImage('keeper-standing.png');
    keeperwalkleft=loadAnimation('keeper-walking/left/1.png','keeper-walking/left/8.png');
    keeperwalkright=loadAnimation('keeper-walking/right/1.png','keeper-walking/right/8.png');
    keepericebox=loadAnimation('keeper-icebox/1.png','keeper-icebox/12.png');
    keeperbed=loadAnimation('keeper-bed/1.png','keeper-bed/22.png');
    keepertube=loadAnimation('keeper-tube/1.png','keeper-tube/11.png');

    // letters
    boss1=loadImage('letters/boss1.png');
    boss2=loadImage('letters/boss2.png');
    boss3=loadImage('letters/boss3.png');
    chasing1=loadImage('letters/chasing1.png');
    chasing2=loadImage('letters/chasing2.png');
    chasing3=loadImage('letters/chasing3.png');
    comrade1=loadImage('letters/comrade1.png');
    comrade2=loadImage('letters/comrade2.png');
    comrade3=loadImage('letters/comrade3.png');
    jean1=loadImage('letters/jean1.png');
    rescued1=loadImage('letters/rescued1.png');
    rescued2=loadImage('letters/rescued2.png');
    sam1=loadImage('letters/sam1.png');
    supplies1=loadImage('letters/supplies1.png');
    supplies2=loadImage('letters/supplies2.png');
    supplies3=loadImage('letters/supplies3.png');

    // food 
    noodles=loadImage('food/noodles.png');
    rice=loadImage('food/rice.png');
    potatoes=loadImage('food/potatoes.png');
    soup=loadImage('food/soup.png');
    sandwich=loadImage('food/sandwich.png');

    food = [noodles,rice,potatoes,soup,sandwich];

    // letter arrays (for random generation)
    boss = [boss1, boss2, boss3];
    chasing = [chasing1,chasing2,chasing3];
    comrade = [comrade1,comrade2,comrade3];
    rescued = [rescued1,rescued2];
    supplies = [supplies1,supplies2,supplies3];
    jean = [jean1];
    sam = [sam1];

    letters = [boss,chasing,comrade,rescued,supplies,jean,sam];

} 
function setup(){
    createCanvas(800,800);
    frameRate(30);
}
function draw(){
    // draw images and clones

    keeper.animx=keeper.x+15;
    keeper.animy=keeper.y+24;
    
    background(0);

    image(clouds5,clouds5x,100);
    image(clouds5,(clouds5x-1200),100);
    image(clouds4,clouds4x,100);
    image(clouds4,(clouds4x-1200),100);
    image(clouds3,clouds3x,100);
    image(clouds3,(clouds3x-1200),100);
    image(clouds2,clouds2x,100);
    image(clouds2,(clouds2x-1200),100);
    image(clouds1,clouds1x,100);
    image(clouds1,(clouds1x-1200),100);

    image(lighthousebg,0,0);
    animation(light,400,400);
    
    image(bed.pic,bed.x,bed.y);
    image(icebox.pic,icebox.x,icebox.y);
    image(tube.pic,tube.x,tube.y);

    // the action state controls whether the keeper is idle, walking or interacting with an object
    // the player can only click on objects while the keeper is idle 
    if (keeper.actionstate == "walking"){
        if (keeper.distancex>0){
            animation(keeperwalkleft,keeper.animx,keeper.animy);
        } else {
            animation(keeperwalkright,keeper.animx,keeper.animy);
        }
        if (distancecheck((keeper.x),(keeper.y),(keeper.destinationx[0]),(keeper.destinationy[0]))){
            keeper.destinationx.shift();
            keeper.destinationy.shift();
            keeper.distancex = keeper.destinationx[0] - keeper.x;
            keeper.distancey = keeper.destinationy[0] - keeper.y;
            if (keeper.destinationx.length == 0){
                keeper.actionstate = "interacting";
            };
        } else {
            movement(keeper);
        }

    } else if (keeper.actionstate=="idle"){
        image(keeperstanding,keeper.x,keeper.y);

    } else if (keeper.actionstate == "interacting"){
        interaction();

    } else if (keeper.actionstate == "letter"){
        image(keeperstanding,keeper.x,keeper.y);

    } 

    // these images appear over the keeper (so the keeper walks behind them)
    image(balcony1.pic,balcony1.x,balcony1.y);
    image(balcony3.pic,balcony3.x,balcony3.y);
    image(arch,0,0);

    if (keeper.actionstate == "letter") {
        // takes the first object in the array so that the first letter in a series will always be read before the others
        image(todaysletter[0], 150, 50);
        
    }

    

    // move clouds
    clouds5x= clouds5x+0.5;
    clouds4x=clouds4x+1;
    clouds3x=clouds3x+2; 
    clouds2x=clouds2x+3;
    clouds1x=clouds1x+5;

    if (clouds5x>=1200){
        clouds5x=0;
    }
    if (clouds4x>=1200){
        clouds4x=0;
    } 
    if (clouds3x>=1200){
        clouds3x=0;
    } 
    if (clouds2x>=1200){
        clouds2x=0;
    } 
    if (clouds1x>=1200){
        clouds1x=0;
    }

}

// when the mouse is clicked, check whether an object was clicked and instruct the keeper to go to it 
function mousePressed(){

    clickedX=mouseX;
    clickedY=mouseY;

// things can only be clicked if the keeper is idle 
if (keeper.actionstate=="idle"){
    allobjects.forEach(function(clickedobject){
        // check if an object is clicked (as opposed to empty space)
        if (clickedobject.clickcheck(clickedX,clickedY)){
            // the player can't click the same object twice in a row 
            if (keeper.objectstate==clickedobject.name){

            } else {
                // the keeper's state changes to the clicked object 
                keeper.objectstate = clickedobject.name;
                // set the keeper's destination to the object coords
                if (keeper.room==clickedobject.room){
                    keeper.destinationx.push(clickedobject.x);
                    keeper.destinationy.push(clickedobject.y);
                } else {
                    if (keeper.room==house){
                        if (clickedobject.room==lighthouse){
                            keeper.destinationx.push(house.x);
                            keeper.destinationx.push(stairs.x);
                            keeper.destinationx.push(upstairs1.x);
                            keeper.destinationx.push(upstairs2.x);
                            keeper.destinationx.push(upstairs3.x);
                            keeper.destinationx.push(upstairs4.x);
                            keeper.destinationx.push(upstairs5.x);
                            keeper.destinationx.push(upstairs6.x);
                            keeper.destinationx.push(upstairs7.x);
                            keeper.destinationx.push(lighthouse.x);

                            keeper.destinationy.push(house.y);
                            keeper.destinationy.push(stairs.y);
                            keeper.destinationy.push(upstairs1.y);
                            keeper.destinationy.push(upstairs2.y);
                            keeper.destinationy.push(upstairs3.y);
                            keeper.destinationy.push(upstairs4.y);
                            keeper.destinationy.push(upstairs5.y);
                            keeper.destinationy.push(upstairs6.y);
                            keeper.destinationy.push(upstairs7.y);
                            keeper.destinationy.push(lighthouse.y);
                        } else if (clickedobject.room==stairs){
                            keeper.destinationx.push(house.x);
                            keeper.destinationx.push(stairs.x);

                            keeper.destinationy.push(house.y);
                            keeper.destinationy.push(stairs.y);
                        }
                    } else if (keeper.room==stairs){
                        if (clickedobject.room==lighthouse){
                            keeper.destinationx.push(upstairs1.x);
                            keeper.destinationx.push(upstairs2.x);
                            keeper.destinationx.push(upstairs3.x);
                            keeper.destinationx.push(upstairs4.x);
                            keeper.destinationx.push(upstairs5.x);
                            keeper.destinationx.push(upstairs6.x);
                            keeper.destinationx.push(upstairs7.x);
                            keeper.destinationx.push(lighthouse.x);

                            keeper.destinationy.push(upstairs1.y);
                            keeper.destinationy.push(upstairs2.y);
                            keeper.destinationy.push(upstairs3.y);
                            keeper.destinationy.push(upstairs4.y);
                            keeper.destinationy.push(upstairs5.y);
                            keeper.destinationy.push(upstairs6.y);
                            keeper.destinationy.push(upstairs7.y);
                            keeper.destinationy.push(lighthouse.y);
                        } else if (clickedobject.room==house){
                            keeper.destinationx.push(stairs.x);
                            keeper.destinationx.push(house.x);

                            keeper.destinationy.push(stairs.y);
                            keeper.destinationy.push(house.y);
                        }
                    } else if (keeper.room==lighthouse){
                        if (clickedobject.room==stairs){
                            keeper.destinationx.push(lighthouse.x);
                            keeper.destinationx.push(upstairs7.x);
                            keeper.destinationx.push(upstairs6.x);
                            keeper.destinationx.push(upstairs5.x);
                            keeper.destinationx.push(upstairs4.x);
                            keeper.destinationx.push(upstairs3.x);
                            keeper.destinationx.push(upstairs2.x);
                            keeper.destinationx.push(upstairs1.x);

                            keeper.destinationy.push(lighthouse.y);
                            keeper.destinationy.push(upstairs7.y);
                            keeper.destinationy.push(upstairs6.y);
                            keeper.destinationy.push(upstairs5.y);
                            keeper.destinationy.push(upstairs4.y);
                            keeper.destinationy.push(upstairs3.y);
                            keeper.destinationy.push(upstairs2.y);
                            keeper.destinationy.push(upstairs1.y);

                        } else if (clickedobject.room==house){
                            keeper.destinationx.push(lighthouse.x);
                            keeper.destinationx.push(upstairs7.x);
                            keeper.destinationx.push(upstairs6.x);
                            keeper.destinationx.push(upstairs5.x);
                            keeper.destinationx.push(upstairs4.x);
                            keeper.destinationx.push(upstairs3.x);
                            keeper.destinationx.push(upstairs2.x);
                            keeper.destinationx.push(upstairs1.x);
                            keeper.destinationx.push(stairs.x);
                            keeper.destinationx.push(house.x);

                            keeper.destinationy.push(lighthouse.y);
                            keeper.destinationy.push(upstairs7.y);
                            keeper.destinationy.push(upstairs6.y);
                            keeper.destinationy.push(upstairs5.y);
                            keeper.destinationy.push(upstairs4.y);
                            keeper.destinationy.push(upstairs3.y);
                            keeper.destinationy.push(upstairs2.y);
                            keeper.destinationy.push(upstairs1.y);
                            keeper.destinationy.push(stairs.y);
                            keeper.destinationy.push(house.y);

                        }

                    }
                    keeper.destinationx.push(clickedobject.x);
                    keeper.destinationy.push(clickedobject.y);
                    keeper.room=clickedobject.room;
                }
                
                // calculate the distance between the keeper and the object
                keeper.distancex = keeper.destinationx[0] - keeper.x;
                keeper.distancey = keeper.destinationy[0] - keeper.y;
                // keeper starts walking
                keeper.actionstate = "walking";
            }
            
        }
    })
} else if (keeper.actionstate=="letter"){
    // if there is only one letter left in the series, that series gets removed from the array of letters
    if (todaysletter.length == 1) {
            letters.splice(letternumber, 1);
        } else {
            // if there is more than one letter left, remove the first letter in the series 
            todaysletter.shift();
        } 
    keeper.actionstate="idle";
} 

}

function movement(keeper){
    keeper.x+=keeper.distancex/speed;
    keeper.y+=keeper.distancey/speed;
}

function distancecheck(x,y,a,b){
    // the distance is within 20 pixels so as to avoid the keeper missing the check altogether and walking 
    // off into nowhere 
    if (a-10<x && x<a+10){
        if (b-10<y && y<b+10){
            return true;
        } else {
            return false;
        }
    } else {
        return false;
    }
}

function interaction(){
    if (keeper.objectstate=="bed"){
        keeper.x=584;
        keeper.y=543;
        animation(keeperbed,keeper.animx,keeper.animy);
        if (keeperbed.getFrame()==keeperbed.getLastFrame()){
            keeperbed.changeFrame(0);
            // when the keeper goes to bed, letters can be checked again and you can get more food
            lettercheck=0;
            foodcheck=0;
            keeper.actionstate="idle";
        }
    } else if (keeper.objectstate=="icebox"){
        keeper.x = 666;
        keeper.y = 585;
        animation(keepericebox,keeper.animx,keeper.animy);
        // if the fridge hasn't been checked, you can get food
        if (foodcheck==0){
                foodgen();
                foodcheck=1;
            }
        image(todaysfood,643,540);
        if (keepericebox.getFrame()==keepericebox.getLastFrame()){
            keepericebox.changeFrame(0);
            keeper.actionstate="idle";
        }
    } else if (keeper.objectstate=="tube"){
        keeper.x = 405;
        keeper.y = 571;
        animation(keepertube,keeper.animx,keeper.animy);
        if (keepertube.getFrame()==keepertube.getLastFrame()){
            keepertube.changeFrame(0);
            // if the tube has been checked already today, there is nothing
            if (lettercheck==1){
                keeper.actionstate="idle";
            // if there are no letters left, don't generate a letter
            } else if (letters.length == 0){
                keeper.actionstate="idle";
            // if the tube hasn't been checked, a letter is randomly generated
            } else {
                lettergen();
                lettercheck=1;
                keeper.actionstate="letter";
            }
        }
    } else if (keeper.objectstate=="balcony1"){
        keeper.actionstate="idle";
    } else if (keeper.objectstate=="balcony2"){
        keeper.actionstate="idle"; 
    } else if (keeper.objectstate=="balcony3"){
        keeper.actionstate="idle";
    } else if (keeper.objectstate=="balcony4"){
        keeper.actionstate="idle";
    }
}

function lettergen(){
    // generates one letter a day at random
    letternumber = int(random(letters.length));
    todaysletter = letters[letternumber];
}

function foodgen(){
    foodnumber = int(random(food.length));
    todaysfood = food[foodnumber];
}

</script>
</head>
<body>

</body>
</html>